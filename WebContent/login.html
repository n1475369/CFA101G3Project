<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/cssreset.css">
    <link rel="stylesheet" href="css/login.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <title>嫁給幸福登入</title>
</head>
<body>
    <div class="login-wrap">
        <div class="login-container">
            <a href="#"><img src="images/MHlogo_04.svg" alt=""></a>
            <h2>登入您的 MarryHappiness 嫁給幸福帳號</h2>
            <form action="" class="login-form">
                <label for="">Email</label><br>
                <input type="text" id = "username" name="username" placeholder="請輸入您的Email">
                <h3 id="u-prompt"></h3>
                <label for="">密碼</label><br>
                <input type="password" id="password" name="password" maxlength="20" placeholder="請輸入您的密碼">
                <h3 id="p-prompt"></h3>
                <input type="button" id="login" value="登入" class="btn btn-primary" disabled>
                <a href="#">忘記密碼</a>
                <span>|</span>
                <a href="#">免費註冊</a>
            </form>
        </div>
        <h2 class="login-footer"><a href="#">立即加入 </a>MarryHappiness 嫁給幸福的商家吧！</h2>
    </div>
    <script>
        $(function(){
            let u_flag = false;
            let p_flag = false;

            function checkFlag(){
                if(u_flag && p_flag){
                    $("#login").removeAttr("disabled") 
                }else{
                    $("#login").attr("disabled", "disabled") 
                }
            }

            $('#username').on('input',function(){
                $('#u-prompt').text("");
                if(validateUsername()){
                    $('#username').css('border','2px solid #27da80')
                    u_flag = true;
                }else{
                    $('#u-prompt').text("請輸入有效的電子郵件地址");
                    $('#u-prompt').css('color','red');
                    $('#u-prompt').css('font-size','10px');
                    $('#username').css('border','2px solid red')
                    u_flag = false;
                }
                checkFlag();
            });

            $('#password').on('input',function(){
                $('#p-prompt').text("");
                if(validatePassword()){
                    $('#password').css('border','2px solid #27da80')
                    p_flag = true;
                }else{
                    $('#p-prompt').text("密碼長度限制6-20");
                    $('#p-prompt').css('color','red');
                    $('#p-prompt').css('font-size','10px');
                    $('#password').css('border','2px solid red')
                    p_flag = false;
                }
                checkFlag();
            });

            $('#login').on('click',function(){
                let username = $('#username').val();
                let password = $('#password').val();
                $.ajax({
                    type:"post",
                    url:"loginServlet",
                    data:{
                        "username":username,
                        "password":password
                    },
                    success:function (result) {
                        if(result=="1"){
                            window.location.href="index.html";
                        }else{
                            $('#u-prompt').text("帳號或密碼錯誤");
                            $('#u-prompt').css('color','red');
                            $('#u-prompt').css('font-size','10px');
                            $('#username').css('border','2px solid red')
                        }
                    }
                });
            });



            function validateUsername() {
                let username = $('#username').val();
                const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(username);
            }

            function validatePassword(){
                let password = $('#password').val();
                const re = /^[0-9A-Za-z]{6,20}$/;
                return re.test(password);
            }

        });
    </script>
</body>
</html>